{# <?php #}
	/* CREATE[{%for verb in methods %}{%if not loop.first%}|{%endif%}{{verb}}{%endfor%}] */
	public function {{action}}Action()
	{
		$request = $this->getRequest();

		$form = new {{entity.name}}Form(False, 'create_{{action}}');
		$form->get('submit')->setValue('Add');

		if ($request->isPost()) {
			{{entity.name|variabilize}} = new {{entity.name}}();
			//$form->setHydrator(new ClassMethodsHydrator());
			$form->bind({{entity.name|variabilize}});
			$inputFilter = {{entity.name|variabilize}}->getInputFilter(False, False);// hasPrimaryKey=False
			$form->setInputFilter($inputFilter);
			$form->setData($request->getPost());

			if ($form->isValid()) {
				try {
					// assert $_POST['city_id'] == $_GET['city_id']
					//$this->table->saveCity($city);
					$table = $this->getTable();
					$data = {{entity.name|variabilize}}->getArrayCopy();
					unset($data['city_id']);
					{{entity.name|variabilize}}Rowset = $table->insert($data);
					return $this->redirect()->toRoute('application', ['controller' => '{{entity.name|slugify}}', 'action' => '{{action}}', 'id'=>$table->getLastInsertValue()]);

				} catch (\Exception $e) {
					return ['form' => $form];
					//return $this->redirect()->toRoute('application', ['controller' => 'index', 'action' => 'index']);
				}
			} else {
				return ['form' => $form];
			}
		//} else if ($request->isGet()) {
		//} else if ($request->isPut()) {
		//} else if ($request->isDelete()) {
		} else {
			//$city_id = (int) $this->params()->fromRoute('id', 0);
			//$country_id = (int) $this->params()->fromRoute('id_parent', 0);

			//$form->get('city_id')->setValue($city_id);
			//$form->get('country_id')->setValue($country_id);// When ForeignKey is Mandatory (use parent to create child)
			return ['form' => $form];
		}
	}

